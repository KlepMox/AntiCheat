package me.rida.anticheat.checks.other;

import org.bukkit.Material;
import org.bukkit.enchantments.Enchantment;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.player.PlayerEditBookEvent;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;
import org.bukkit.inventory.meta.BookMeta;

import me.rida.anticheat.AntiCheat;
import me.rida.anticheat.checks.Check;

public class ExploitA extends Check {

	public ExploitA(AntiCheat AntiCheat) {
		super("Exploit", "Exploit", AntiCheat);

		setEnabled(true);
		setBannable(false);
		setMaxViolations(1);
	}

	@EventHandler
	public void onDamage(PlayerInteractEvent event) {
		Player attacker = event.getPlayer();
		ItemStack is = attacker.getItemInHand();
		if (is == null) {
			return;
		}
		if ((is.getType() != Material.BOOK_AND_QUILL) && (is.getType() != Material.WRITTEN_BOOK)) {
			return;
		}
		if (is.getEnchantments().size() > 0) {
			for (Enchantment ench : is.getEnchantments().keySet()) {
				is.removeEnchantment(ench);
			}

			event.setCancelled(true);
			getAntiCheat().logCheat(this, attacker, "[3] Book and Quill Exploit", "(Type: A)");
			attacker.getInventory().removeItem(new ItemStack[] { is });
		}
	}

	@EventHandler
	public void onEdit(PlayerEditBookEvent event) {
		BookMeta book = event.getNewBookMeta();
		if (book.getEnchants().size() > 0) {
			event.setCancelled(true);
			event.getPlayer().getInventory().remove(Material.BOOK_AND_QUILL);
			getAntiCheat().logCheat(this, event.getPlayer(), "[2] Book and Quill Exploit", "(Type: A)");
		}
	}

}
